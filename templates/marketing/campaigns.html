{% extends 'base.html' %}
{% load static %}
{% load user_tags %}

{% block title %}Campaigns - EmailPro{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <!-- Header -->
    <div class="md:flex md:items-center md:justify-between mb-6">
        <div class="flex-1 min-w-0">
            <h2 class="text-2xl font-bold leading-7 text-gray-900 sm:text-3xl sm:truncate">
                Email Campaigns
            </h2>
            <p class="mt-1 text-sm text-gray-500">
                Manage your email marketing campaigns
            </p>
        </div>
        <div class="mt-4 flex md:mt-0 md:ml-4">
            <a href="{% url 'add_campaign' %}" class="inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                <i class="fas fa-plus mr-2"></i> Create Campaign
            </a>
        </div>
    </div>

    <!-- Filters and Search -->
    <div class="bg-white shadow-sm rounded-lg p-4 mb-6">
        <div class="flex flex-col md:flex-row md:items-center md:justify-between">
            <div class="flex-1 flex flex-col md:flex-row gap-4">
                <div class="w-full md:w-auto">
                    <select id="status-filter" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm">
                        <option value="">All Statuses</option>
                        <option value="draft">Draft</option>
                        <option value="scheduled">Scheduled</option>
                        <option value="sending">Sending</option>
                        <option value="sent">Sent</option>
                        <option value="cancelled">Cancelled</option>
                    </select>
                </div>
                <div class="w-full md:w-auto">
                    <input type="text" id="search" placeholder="Search campaigns..." class="block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm">
                </div>
            </div>
            <div class="mt-4 md:mt-0">
                <button id="apply-filters" class="px-3 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                    Apply Filters
                </button>
            </div>
        </div>
    </div>

    <!-- Campaigns List -->
    <div class="bg-white shadow overflow-hidden sm:rounded-md">
        <ul role="list" class="divide-y divide-gray-200">
            {% for campaign in campaigns %}
            <li>
                <a href="{% url 'campaign_detail' pk=campaign.pk %}" class="block hover:bg-gray-50">
                    <div class="px-4 py-4 sm:px-6">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center">
                                <div class="flex-shrink-0">
                                    <div class="h-12 w-12 rounded-full bg-indigo-100 flex items-center justify-center">
                                        <i class="fas fa-envelope text-indigo-600 text-xl"></i>
                                    </div>
                                </div>
                                <div class="ml-4">
                                    <p class="text-sm font-medium text-indigo-600 truncate">
                                        {{ campaign.name }}
                                    </p>
                                    <p class="mt-1 text-sm text-gray-500 truncate">
                                        Subject: {{ campaign.subject }}
                                    </p>
                                </div>
                            </div>
                            <div class="ml-2 flex-shrink-0 flex items-center">
                                {% if campaign.status == 'draft' %}
                                <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-gray-100 text-gray-800">
                                    Draft
                                </span>
                                {% elif campaign.status == 'scheduled' %}
                                <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-yellow-100 text-yellow-800">
                                    Scheduled
                                </span>
                                {% elif campaign.status == 'sending' %}
                                <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-blue-100 text-blue-800">
                                    Sending
                                </span>
                                {% elif campaign.status == 'sent' %}
                                <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">
                                    Sent
                                </span>
                                {% elif campaign.status == 'cancelled' %}
                                <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-red-100 text-red-800">
                                    Cancelled
                                </span>
                                {% endif %}
                            </div>
                        </div>
                        <div class="mt-2 sm:flex sm:justify-between">
                            <div class="sm:flex">
                                <p class="flex items-center text-sm text-gray-500">
                                    <i class="fas fa-users flex-shrink-0 mr-1.5 text-gray-400"></i>
                                    Lists: {{ campaign.lists.count }}
                                </p>
                            </div>
                            <div class="mt-2 flex items-center text-sm text-gray-500 sm:mt-0">
                                <i class="fas fa-calendar flex-shrink-0 mr-1.5 text-gray-400"></i>
                                <p>
                                    {% if campaign.status == 'scheduled' %}
                                        Scheduled for {{ campaign.schedule_time|date:"M d, Y H:i" }}
                                    {% elif campaign.status == 'sent' %}
                                        Sent {{ campaign.sent_time|date:"M d, Y" }}
                                    {% else %}
                                        Created {{ campaign.created_at|date:"M d, Y" }}
                                    {% endif %}
                                </p>
                            </div>
                        </div>
                    </div>
                </a>
            </li>
            {% empty %}
            <li class="px-4 py-8 text-center">
                <div class="flex flex-col items-center">
                    <div class="h-16 w-16 rounded-full bg-gray-100 flex items-center justify-center mb-4">
                        <i class="fas fa-envelope text-gray-400 text-2xl"></i>
                    </div>
                    <h3 class="text-lg font-medium text-gray-900 mb-1">No campaigns yet</h3>
                    <p class="text-gray-500 mb-4">Create your first email campaign to start engaging with your audience.</p>
                    <a href="{% url 'add_campaign' %}" class="inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                        <i class="fas fa-plus mr-2"></i> Create First Campaign
                    </a>
                </div>
            </li>
            {% endfor %}
        </ul>
    </div>

    <!-- Pagination -->
    {% if campaigns.has_other_pages %}
    <nav class="border-t border-gray-200 px-4 flex items-center justify-between sm:px-0 mt-6">
        <div class="w-0 flex-1 flex">
            {% if campaigns.has_previous %}
            <a href="?page={{ campaigns.previous_page_number }}" class="border-t-2 border-transparent pt-4 pr-1 inline-flex items-center text-sm font-medium text-gray-500 hover:text-gray-700 hover:border-gray-300">
                <i class="fas fa-arrow-left mr-3 text-gray-400"></i>
                Previous
            </a>
            {% endif %}
        </div>
        <div class="hidden md:flex">
            {% for i in campaigns.paginator.page_range %}
                {% if campaigns.number == i %}
                <a href="#" class="border-indigo-500 text-indigo-600 border-t-2 pt-4 px-4 inline-flex items-center text-sm font-medium" aria-current="page">
                    {{ i }}
                </a>
                {% else %}
                <a href="?page={{ i }}" class="border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 border-t-2 pt-4 px-4 inline-flex items-center text-sm font-medium">
                    {{ i }}
                </a>
                {% endif %}
            {% endfor %}
        </div>
        <div class="w-0 flex-1 flex justify-end">
            {% if campaigns.has_next %}
            <a href="?page={{ campaigns.next_page_number }}" class="border-t-2 border-transparent pt-4 pl-1 inline-flex items-center text-sm font-medium text-gray-500 hover:text-gray-700 hover:border-gray-300">
                Next
                <i class="fas fa-arrow-right ml-3 text-gray-400"></i>
            </a>
            {% endif %}
        </div>
    </nav>
    {% endif %}
</div>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const statusFilter = document.getElementById('status-filter');
        const searchInput = document.getElementById('search');
        const applyButton = document.getElementById('apply-filters');
        
        // Apply filters when button is clicked
        applyButton.addEventListener('click', function() {
            let url = new URL(window.location.href);
            
            // Add status filter
            if (statusFilter.value) {
                url.searchParams.set('status', statusFilter.value);
            } else {
                url.searchParams.delete('status');
            }
            
            // Add search query
            if (searchInput.value.trim()) {
                url.searchParams.set('search', searchInput.value.trim());
            } else {
                url.searchParams.delete('search');
            }
            
            // Navigate to filtered URL
            window.location.href = url.toString();
        });
        
        // Set initial values from URL params
        const params = new URLSearchParams(window.location.search);
        if (params.has('status')) {
            statusFilter.value = params.get('status');
        }
        if (params.has('search')) {
            searchInput.value = params.get('search');
        }
    });
</script>
{% endblock %} 